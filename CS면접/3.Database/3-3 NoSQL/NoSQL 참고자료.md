# NoSQL



##### Not Only SQL의 약자로 기존 RDBMs 형태의 관계형 데이터베이스가 아닌 다른 형태의 데이터 저장 기술을 의미하며, 

##### 관계형 데이터 베이스의 한계를 극복하기 위한 데이터 저장소의 새로운 형태로, **수평적 확장성**을 갖고 있다.

<br>

<br>

### 자세하게 보기

- 대부분 **클러스터에서 실행할 목적**으로 만들어졌기 때문에 **관계형 모델을 사용하지 않는다**. 

  그러나 모든 NoSQL 데이터베이스가 클러스터에서 실행되도록 맞춰진 것은 아니다.

  예를 들어 NoSQL 데이터 모델 중 하나인 그래프 데이터베이스는 관계형 데이터베이스와 비슷한 분산 모델을 사용한다.

- 보통 21세기 초반 웹 환경의 필요에 기초를 두고 있어서, 이 시기에 개발된 시스템만을 NoSQL이라고 부른다. 

  따라서 그 이전에 만들어진 ODBMS(Objective Database Management System)은 NoSQL에 해당하지 않는다.

- **스키마 없이 동작**하며, 구조에 대한 정의를 변경할 필요 없이 데이터베이스 레코드에 자유롭게 필드를 추가할 수 있다.

- NoSQL에서는 RDBMS와는 달리 테이블 간 관계를 정의하지 않는다. 

  데이터 테이블은 그냥 하나의 테이블이며 테이블 간의 관계를 정의하지 않아 일반적으로 테이블 간 **Join도 불가능**하다. 

<br>

<br>

### 왜 사용해야 할까?

```
NoSQL 데이터베이스는 탁월한 사용자 경험을 제공하기 위하여 유연성과 확장성을 비롯해 
고성능의 매우 기능적인 데이터베이스를 필요로 하는 모바일, 웹이나 
게이밍과 같은 다양한 현대적인 애플리케이션에 적합하다.
```

<br>

- **유연성:**
  NoSQL 데이터베이스는 일반적으로 유연한 스키마를 제공하여, 보다 빠르고 반복적인 개발을 가능하게 해준다.

<br>

- **확장성:**
  NoSQL 데이터베이스는 일반적으로 고가의 강력한 서버를 추가하는 대신 분산형 하드웨어 클러스터를 이용해 확장하도록 설계되었다.

<br>

- **고성능:**
  NoSQL 데이터베이스는 특정 데이터 모델(문서, 키 값, 그래프 등) 및 엑세스 패턴에 대해 최적화되어 관계형 데이터베이스를 통해 유사한 기능을 충족하려 할 때보다 뛰어난 성능을 얻게 해준다.

  입력 작업의 경우에도 마찬가지로 캐시메모리에 일단 값을 입력하고 결과값을 사용자에게 회신한 뒤에 실제적인 데이터를 데이터베이스에 입력하는 방식으로 처리하면 더 빠른 연산 결과를 내보낼 수 있다.
  단, 메모리의 경우는 한정적인 자원이고 세션이 끊기거나 작업이 종료되는 경우 날라가므로 관리가 필요하다.
  메모리를 통해 key-value database 방식을 많이 사용하는 형태는 쇼핑몰의 장바구니를 예로 들 수 있겠다.
  단순한 형태의 구조이므로 키-값 방식을 적용하기에도 적합해보인다.

<br>

- **고기능성:**
  NoSQL 데이터베이스는 각 데이터 모델에 맞추어 특별히 구축된 뛰어난 기능의 API와 데이터 유형을 제공한다.

<br>

<br>

### 특징

1. **NoSQL은 RDBMS와는 달리 데이터 간의 관계를 정의하지 않는다**

   

   - 가장 큰 특징 중 하나는 관계형 데이터 베이스인 RDBMS가 데이터의 관계를 Foreign Key 등으로 정의하고 이를 이용해 Join 등의 관계형 연산을 한다고 하면,
   - NoSQL은 데이터 간의 관계를 정의하지 않는다. 데이터 테이블은 그냥 하나의 테이블이며 각 테이블 간의 관계를 정의하지 않고 일반적으로 테이블 간의 Join도 불가능하다.

   

2. **RDBMS에 비해 훨씬 더 대용량의 데이터를 저장할 수 있다**

   

   - RDBMS의 복잡도와 용량의 한계를 극복하기 위한 목적으로 등장한 만큼 페타바이트급의 대용량 데이터를 저장할 수 있다.

   

3. **분산형 구조이다**

   

   - NoSQL은 기존 RDBMS와는 다르게 하나의 고성능 머신에 데이터를 저장하는 것이 아니라 **일반적인 서버 수십 대를 연결해 데이터를 저장 및 처리하는 구조**를 갖는다.
     즉 분산형 구조를 통해 데이터를 여러 대의 서버에 분산해 저장하고 분산 시에 데이터를 상호 복제해 특정 서버에 장애가 발생했을 때에도 데이터 유실이나 서비스 중지가 없는 구조의 형태를 가진다.

   

4. **고정되지 않은 테이블 스키마를 갖는다**

   

   - RDBMS와는 다르게 테이블의 스키마가 유동적이다. 데이터를 저장하는 컬럼은 각기 다른 이름과 다른 데이터 타입을 갖는 것이 허용된다.
   - 스키마란? 데이터베이스의 구조와 제약 조건에 관한 전반적인 명세를 기술한 메타데이터의 집합이다.

<br>

<br>

<br>

# 종 류

![제목 없음](https://user-images.githubusercontent.com/89068148/172013479-f0491a56-a6b5-49bd-a183-d72177468a28.png)

### 1. **키-값 데이터베이스**

- 프로그램을 하다보면 자주 만나게 되는 key-value 형태를 가지는 데이터베이스다.
- 데이터를 식별하기 위해서 key값을 알면 연결된 데이터를 확인할 수 있는 구조로 비교적 간단한 형태의 데이터베이스에 적합하다.

 

#### **키-값 데이터베이스의 구성요소**

**1) 키**

\- 값을 가져오기 위한 식별자, 이름공간 내에서 고유해야 한다.

\- 이름공간이란 키-값 쌍을 묶어둔 것으로 데이터베이스라고 보면된다. 즉 키-값 데이터베이스 내에서 키는 중복될 수 없다. 다만 키가 다르다면 값은 얼마든지 중복되어도 관계없다.

\- 키를 통해 값을 찾아와야 하므로 명명 규칙을 세워서 의미있는 값으로 만드는 것이 좋다 (RDBMS에서는 키값은 의미없는 숫자 등으로 생성)

\- 키값을 처리하기 위해서 해시(Hash) 함수를 사용하기도 한다.

 

**2) 값**

\- 키-값 데이터베이스에서 값의 데이터 타입에는 큰 제약이 없다.

\- 정수, 실수, 문자열, BLOB, JSON 객체, 이미지, 오디오, list 등... 다양한 값이 들어갈 수 있다.

 

 

### **단점과 한계점**

**1) 값 검색에 대한 한계**

\- 키를 통해 값을 검색하고 수정 및 삭제를 진행할 수 있으나, 값을 기준으로 한 검색은 어렵다.

 ***=> 방법이 없는 것은 아니나 키를 기준으로 한 검색보다는 효율성이 떨어진다.\***

\- 값에 대해 텍스트 검색을 하는 방법 (Riak)

\- 키만 사용해서 검색하는 경우 보조 인덱스 (Secondary Index)를 사용하여 값의 속성을 인덱스로 만들 수 있음

 

**2) 범위 질의를 지원하지 않음**

\- 시작일 ~ 종료일 사이의 데이터를 검색하거나 특정 범위 내의 데이터를 검색하는 기능 없음

\- 이 역시 보조 인덱스를 사용해서 기능을 보완해야 한다.

 

**3) RDBMS (관계형 데이터베이스) 의 SQL처럼 활용성 있는 질의언어가 없음**

\- 간단한 조회를 위한 구조이므로 질의 언어가 없음

\- 일부 데이터베이스의 경우 XML, JSON 등의 데이터 구조를 지원하므로 이를 이용해서 검색할 수 있다.

 

 

#### **설계 시 고려해야 하는 것**

잘 설계된 키는 코드를 더 읽기 쉽게 하며, 키-값 데이터베이스의 관리 효율성을 높인다.

키를 설계함에 있어서 명명규칙을 따르는 것이 좋으며, 아래의 사항을 고려하는 것이 좋다고 한다.

> Tip
>
> **- 단어 사용 시 애매하지 않은 단어를 이용해서 명확하게 표현하는 것이 좋다.**
> **- 키를 만들기 위해 공통 구분자를 사용한다. 일반적으로 사용되는 것은 : (콜론) 이다.**
> **- 구간 검색을 쉽게 하기 위해 범위를 기반으로 하는 용어를 사용한다. (ex. 날짜나 정수형)**
> **- 키는 가능한 짧게 만든다.**

잘 설계된 키는 코드의 가독성을 높일 뿐 아니라 코드의 양 자체를 줄일 수 있다.

또한 범위를 기반으로 하는 용어를 키에 포함시키면 키-값 데이터베이스의 한계로 지적되는 검색을 용이하게 할 수 있다. (물론 보조 인덱스 등으로 검색하는게 효율성은 높다고 한다.)

 

그렇다면 키-값 데이터베이스에서 **키만 잘 설계**하면 될까?

물론 키를 설계하는 게 제일 중요하겠지만 **값의 경우도 고려**할 사항이 있다.

 

#### **구조화 된 데이터 유형은 대기 시간을 줄이는 데 도움이 된다.**

: 여기서 말하는 대기시간은 데이터를 디스크에서 읽어들이는데 사용되는 시간을 말한다.

: 대기 시간을 줄이기 위해서는 자주 사용되는 값을 메모리에 저장하는 방식이 있으나, 메모리 공간이 부족하다는 제약이 있다.

: 다른 방법으로는 자주 사용되는 속성을 함께 저장하는 방식이다. 자주 사용될 대상을 묶어서 저장해두어 한 번 조회했을 때 값을 가져올 수 있으므로 데이터 탐색 횟수를 줄일 수 있다.

**: 이 경우 중복된 데이터가 값에 여러개 들어갈 수 있으나 키-값 데이터베이스에서는 큰 문제가 되지 않는다.**

 의도적인 비정규화로 데이터 탐색 횟수를 줄이기 위한 방안이다.

 

#### **값이 크면 읽기/쓰기 연산이 비효율적일 수 있다.**

: 자주 사용될 대상을 묶어서 저장하라는 위의 내용과 약간은 상반되는 부분이 있지만, 정도를 지켜야 한다는 의미이다.

: 예를 들어 주문정보를 담고 있을 때, 대상에 모든 주문 정보를 담게 되면 데이터 읽기 및 주문정보 갱신 시 쓰기에도 많은 시간을 소요하게 된다.

: 값이 아주 큰 경우는 키-값 데이터베이스가 아닌 문서 데이터베이스를 사용하는 것이 좋다.

 

 

### 2. **문서 데이터베이스**

- 데이터 저장방식은 키-값 데이터베이스와 비슷하나, 값을 **문서**로 저장한다는 차이점이 있다.
- 여기서 말하는 문서란 반정형화된 엔티티로 XML, JSON 같은 형식이 이에 속한다. 워드나 엑셀 등의 문서 파일이 아니라는 점.

예를 들자면 다음과 같다.

```javascript
{ 
  name : "ojava",
  job : "programmer",
  detail : "java"
}
```

\- 값에 하나의 형태만 들어갈 수 있는 키-값 데이터베이스와 달리, **문서는 여러 속성을 저장**할 수 있다.

\- 고정된 스키마로 저장할 필요가 없으므로 높은 유연성을 지닌다.

 ***=> 개발자 입장에서는 필수적으로 입력되어야 하는 정보에 대해서 지정해주거나 체크하는 로직 필요\***

\- 문서에 하나의 값이 아닌 여러개의 속성을 지닐 뿐 아니라, 또 다른 문서를 중첩해서 입력할 수 있다.

\- 질의어를 통해 데이터를 찾을 수 있다.

 ***=> db.employee.find({ detail: "java" }) 와 같이 쓰거나, AND, OR, = 등의 연산 검색이 가능하다.\***

 

 

### 3. **컬럼 패밀리 데이터베이스**

- NoSQL 중 가장 복잡한 유형이다.
- 컬럼, 로우 등의 명칭이 나와서 관계형 데이터베이스와 비슷해보이나 차이점을 가지므로 유의해서 보자.

\- 컬럼 Column 은 이름과 값을 가질 수 있다.

\- 하나의 로우 row 는 여러 개의 컬럼이 모여서 이루어지며, 각각의 로우는 다른 컬럼을 가질 수 있다.

\- 연관된 컬럼이 여러개가 있다면 묶어서 '컬럼 패밀리'로 만들어서 사용한다.

\- 문서 데이터베이스와 비슷하게 고정된 스키마를 사용하지 않는다.

\- 로우 별로 다른 데이터 형태를 가지므로 관계형 데이터에비으와 달리 조인이 불가능하다.

 ***=> 조인할 필요 없이 원하는 컬럼을 모아서 하나의 로우에 담는다고 한다.\***

\- 질의방법은 일반적인 SQL과 비슷하고, CREATE, COLUMNFAMILY 등 이에 특화된 기능도 존재한다.

 

 

### 4. **그래프 데이터베이스**

- 많은 객체와 각 연결 관계를 표현하는데 용이한 방법.
- SNS, 교통망, 전력망 등 연결 관계가 복잡한 형태의 데이터를 다루는데 사용되어진다.
- 노드 Node 와 관계 Relationship 또는 정점 vertext과 엣지 edge 라는 형태로 데이터를 표현하며, 노드는 구별할 수 있는 식별자와 여러 가지 속성을 가지고 관계는 두 노드 간의 연결을 말하며 연결에 대한 속성을 포함한다.

```javascript
ex) 
SNS : 노드가 되는 것은 '사람', 관계는 '사람 간의 연결, 관계'
교통망 : 노드가 되는 것은 '지역', 관계는 '지역 간을 잇는 도로 등'
```

 

\- 노드와 관계 모두 각각의 속성을 가지고 있다.

\- 가까운 관계에 있는 노드들을 잇기 위한 목적으로 설계되었다.

\- 관계형 데이터베이스로는 연산이 복잡한 작업을 그래프 데이터베이스로 대체할 수 있다.

<br>

<br>

---

**NO sql - 수평적 확장성 :**
 \- 서버를 늘리기만 하면은 스케일이 늘어남. 그러면서 응답속도는 보장
**RDBMS - 수직적 확장성 :**
 \- ssd, cpu 업그레이드 하거나, 확장하는데 돈과 손이 많이 듦

**NO sql - 쿼리 언어 없음 :**
 \- 페이스북이나 인스타 같이 유저가 폭발적으로 많고 간단한 데이터를 다루면 채택
**RDBMS - 쿼리 언어 :**
 \- 표준적인 쿼리 언어가 있음. 만일 join을 많이 해야한다면 sql이 나음. 정형데이터는 쇼핑몰 같은것.

**NO sql - 자유로운 스키마 :**
 \- 그냥 추가하고 싶은 어트리뷰트는 제약없이 넣음. 생각없이 만들면 지저분해질 수 있음. no sql은 인덱스는 비효율적. 최대한 key기준으로 쿼리를 작성하는게 요점.
**RDBMS - 강한 스키마 :**
 \- 테이블을 정의하고 나서, 여러 제약조건이 잇음. 타입이라던가 외래키 제약이라던가. 인덱스를 많이 걸게 됨. 만일 인덱스를 많이 체크해야한다면 rdbms가 좋음.